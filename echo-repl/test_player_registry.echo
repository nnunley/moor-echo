// Test player registry functionality

// First, let's check if the system object has the player_registry
#0.player_registry

// Create a function to change username
object $system
  verb change_username(player, new_name)
    // Get the old username
    let old_name = player.username
    
    // Check if new name is already taken
    if (this.player_registry[new_name])
      if (this.player_registry[new_name] != player)
        return "Username already taken"
      endif
    endif
    
    // Update the player's username and display_name
    player.username = new_name
    player.display_name = new_name
    
    // Update the registry
    this.player_registry[old_name] = null
    this.player_registry[new_name] = player
    
    return "Username changed successfully"
  endverb
  
  verb find_player(username)
    // Look up a player by username
    if (this.player_registry[username])
      return this.player_registry[username]
    else
      return null
    endif
  endverb
endobject

// Test creating players (done via REPL commands)
// .player create alice
// .player create bob

// Try changing a username (would be done after players are created)
// $system:change_username($system:find_player("alice"), "alice_wonderland")